# Activar RewriteEngine para redirección amigable
RewriteEngine on

# Evitar mostrar listado de archivos si no hay index, arroja Forddiben
Options -Indexes

# Redirigir HTTP a HTTPS (solo si tienes HTTPS activo)
RewriteCond %{HTTPS} off
RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Enrutamiento limpio para archivos inexistentes
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-l
RewriteRule ^(.*)$ index.php?url=$1 [QSA,L]

# -------- CABECERAS DE SEGURIDAD --------

<IfModule mod_headers.c>
    # Forzar HTTPS en el navegador (HSTS)
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"



    Header set Content-Security-Policy "default-src 'self'; base-uri 'self'; object-src 'none'; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://fonts.googleapis.com https://cdn.jsdelivr.net; font-src 'self' data: https://cdnjs.cloudflare.com https://fonts.googleapis.com https://fonts.gstatic.com; frame-src https://app.powerbi.com https://hym.dispatchtrack.com; child-src https://app.powerbi.com https://hym.dispatchtrack.com; connect-src 'self'; img-src 'self' data:"


    # Evitar Clickjacking
    #Header always set X-Frame-Options "SAMEORIGIN"

    # Impedir sniffing de tipos MIME
    Header set X-Content-Type-Options "nosniff"

    # Política de referencia segura
    Header set Referrer-Policy "strict-origin-when-cross-origin"

    # Limitar APIs del navegador
    Header set Permissions-Policy "geolocation=(), microphone=()"

    # Reporte de errores en la red (opcional, personaliza si tienes endpoint)
    Header set NEL "{ \"report_to\": \"default\", \"max_age\": 31536000, \"include_subdomains\": true }"
    Header set Report-To "{ \"group\": \"default\", \"max_age\": 31536000, \"endpoints\": [{\"url\": \"https://tu-dominio.com/report-endpoint\"}] }"

    # Restringir políticas de acceso cruzado (ej. Flash/PDF)
    Header set X-Permitted-Cross-Domain-Policies "none"

</IfModule>

<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css application/javascript application/json application/xml
    Header append Vary Accept-Encoding
</IfModule>
